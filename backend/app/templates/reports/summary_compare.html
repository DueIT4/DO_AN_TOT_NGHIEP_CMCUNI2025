<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Báo cáo tổng quan</title>

  <style>
    @page { size: A4; margin: 18mm 16mm 18mm 16mm; }

* { box-sizing: border-box; }
body{
  margin: 0;
  font-family: "Times New Roman", Times, serif;
  font-size: 13pt;
  line-height: 1.35;
  color: #000;
}

/* QUAN TRỌNG: không fix 210mm nữa để khỏi tràn */
.page{
  width: 100%;
  margin: 0;
  padding: 0;
}

/* utils */
.bold{ font-weight: 700; }
.upper{ text-transform: uppercase; }
.center{ text-align: center; }
.left{ text-align: left; }
.right{ text-align: right; }

header.header-national{
  text-align: center;
  margin-top: 2mm;
}
.header-national .q1{ font-weight: 700; text-transform: uppercase; }
.header-national .q2{ font-weight: 700; }
.header-national .line{
  width: 80mm;
  margin: 4px auto 0;
  border-bottom: 0.6pt solid #000;  /* mảnh hơn */
}

.title{
  text-align: center;
  margin-top: 10px;
  font-weight: 700;
  text-transform: uppercase;
  font-size: 14.5pt;
}
.sub{
  text-align: center;
  margin-top: 6px;
}

.section{ margin-top: 12px; }
.h{ font-weight: 700; margin-bottom: 6px; }

/* ===== TABLE: tránh tràn + viền nhẹ ===== */
table.table{
  border-collapse: collapse;
  width: 100%;
  table-layout: fixed;           /* giữ cột đúng tỉ lệ */
  border: 0.6pt solid #000;      /* chỉ viền ngoài mảnh */
}

table.table th, table.table td{
  padding: 5px 7px;
  vertical-align: middle;

  /* chỉ kẻ dòng mảnh, không kẻ ô dày */
  border-top: 0.35pt solid #000;
  border-bottom: 0.35pt solid #000;
}

table.table thead th{
  font-weight: 700;
  border-bottom: 0.6pt solid #000;  /* gạch header hơi rõ */
}

/* tránh chữ dài làm vỡ bảng */
table.table th, table.table td{
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* Bảng thời gian: căn trái, hẹp hơn */
table.table-time{
  width: 70%;
  margin-left: 0;
}

/* Bảng metrics */
table.table-metrics{
  margin-top: 6px;
}

/* Callout top disease: viền mảnh */
.callout{
  margin-top: 6px;
  padding: 8px 10px;
  border: 0.6pt solid #000;
}

/* bullets */
ul.bullets{
  margin: 6px 0 0 18px;
}

.footer{ margin-top: 14px; }
.signature{ margin-top: 10px; }
.small{ font-size: 11pt; }
.spacer{ height: 56px; }
.sign-line{
  display: inline-block;
  width: 60mm;
  border-bottom: 0.6pt solid #000;
}

  </style>
</head>

<body>
  <div class="page">
    <header class="header-national">
      <div class="q1">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
      <div class="q2">Độc lập - Tự do - Hạnh phúc</div>
      <div class="line"></div>
    </header>

    <div class="title">BÁO CÁO TỔNG QUAN HỆ THỐNG</div>
    <div class="sub">
      Kỳ báo cáo: <span class="bold">{{ range_label }}</span>
    </div>

    <!-- I -->
    <section class="section">
      <div class="h">I. Phạm vi thời gian</div>

      <table class="table table-time">
        <colgroup>
          <col style="width:30%">
          <col>
        </colgroup>
        <thead>
          <tr>
            <th class="left">Kỳ</th>
            <th class="left">Thời gian</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="bold left">Kỳ này</td>
            <td class="left">{{ cur_from }} → {{ cur_to }}</td>
          </tr>
          <tr>
            <td class="bold left">Kỳ trước</td>
            <td class="left">{{ prev_from }} → {{ prev_to }}</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- II -->
    <section class="section">
      <div class="h">II. Bảng so sánh chỉ số chính</div>

      <table class="table table-metrics">
      <colgroup>
        <col style="width:40%">
        <col style="width:20%">
        <col style="width:20%">
        <col style="width:20%">
      </colgroup>

        <thead>
          <tr>
            <th class="left">Chỉ số</th>
            <th class="center">Kỳ này</th>
            <th class="center">Kỳ trước</th>
            <th class="center">Chênh lệch</th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td class="left">Người dùng mới</td>
            <td class="center">{{ curr_new_users }}</td>
            <td class="center">{{ prev_new_users }}</td>
            <td class="center">{{ d_new_users }}</td>
            <!-- <td class="right">{{ p_new_users }}</td> -->
          </tr>

          <tr>
            <td class="left">Lượt dự đoán</td>
            <td class="center">{{ curr_total_detections }}</td>
            <td class="center">{{ prev_total_detections }}</td>
            <td class="center">{{ d_total_detections }}</td>
            <!-- <td class="right">{{ p_total_detections }}</td> -->
          </tr>

          <tr>
            <td class="left">Ticket đang mở</td>
            <td class="center">{{ curr_open_tickets }}</td>
            <td class="center">{{ prev_open_tickets }}</td>
            <td class="center">{{ d_open_tickets }}</td>
            <!-- <td class="right">{{ p_open_tickets }}</td> -->
          </tr>

          <tr>
            <td class="left">Thiết bị offline</td>
            <td class="center">{{ curr_inactive_devices }}</td>
            <td class="center">{{ prev_inactive_devices }}</td>
            <td class="center">{{ d_inactive_devices }}</td>
            <!-- <td class="right">{{ p_inactive_devices }}</td> -->
          </tr>
        </tbody>
      </table>
    </section>

    <!-- III (điểm nhấn) -->
    <section class="section">
      <div class="h">III. Bệnh được dự đoán nhiều nhất</div>

      <div class="callout">
        <span class="bold">{{ top_disease_name }}</span>
        — {{ top_disease_count }} lượt
        {% if top_disease_share != "—" %}
          ({{ top_disease_share }} trên tổng lượt dự đoán)
        {% endif %}
      </div>

      {% if top_diseases and top_diseases|length > 0 %}
      <table class="table table-metrics" style="margin-top:8px; width: 80%;">
        <colgroup>
          <col style="width:70%">
          <col style="width:30%">
        </colgroup>
        <thead>
          <tr>
            <th class="left">Top bệnh</th>
            <th class="right">Số lượt</th>
          </tr>
        </thead>
        <tbody>
          {% for d in top_diseases %}
          <tr>
            <td class="left">{{ d.disease_name }}</td>
            <td class="right">{{ d.count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endif %}
    </section>

    <!-- IV -->
    <section class="section">
      <div class="h">IV. Đánh giá & kiến nghị</div>
      <ul class="bullets">
        {% for x in insights %}
          <li>{{ x }}</li>
        {% endfor %}
      </ul>
    </section>

    <footer class="footer">
      <div class="right">Ngày {{ day }} tháng {{ month }} năm {{ year }}</div>

      <div class="signature right">
        <div class="bold">Người lập báo cáo</div>
        <div class="small">(Ký và ghi rõ họ tên)</div>
        <div class="spacer"></div>
        <div class="sign-line"></div>
      </div>
    </footer>
  </div>
</body>
</html>
